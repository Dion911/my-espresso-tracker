<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Espresso Tracker — Service Mode</title>

<style>
:root{
  --bg:#fafafa; --panel:#fff; --text:#101113; --muted:#6b6e76;
  --line:#e8e8ea; --hover:#f4f4f5; --danger:#c62f2f;
  --radius:16px; --sans:-apple-system,BlinkMacSystemFont,Inter,system-ui,Arial;
}
*{box-sizing:border-box}
body{margin:0;font-family:var(--sans);background:var(--bg);color:var(--text)}
.wrap{max-width:820px;margin:0 auto;padding:16px}

.top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.title{font-weight:700;font-size:18px}
.subtitle{font-size:13px;color:var(--muted)}

.btn{
  border:1px solid var(--line);
  background:#fff;
  border-radius:14px;
  padding:12px 14px;
  font-weight:600;
  cursor:pointer;
}
.btnPrimary{background:#101113;color:#fff;border-color:#101113}
.btnDanger{color:var(--danger);border-color:#f2c6c6}

.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:14px;
}
.list{display:flex;flex-direction:column;gap:10px}

.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--line);
  font-size:13px;
  cursor:pointer;
}
.chip.active{background:#101113;color:#fff;border-color:#101113}

input,select,textarea{
  width:100%;padding:14px;border-radius:14px;border:1px solid var(--line);
  font-size:16px;
}
label{font-size:13px;color:var(--muted)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.hidden{display:none}
</style>
</head>

<body>
<div class="wrap">

<!-- SERVICE MODE -->
<section id="service">
  <div class="top">
    <div>
      <div class="title">Espresso Tracker</div>
      <div class="subtitle" id="today"></div>
    </div>
    <button class="btn" onclick="view='more';render()">⋯</button>
  </div>

  <button class="btn btnPrimary" style="width:100%;margin-bottom:12px"
    onclick="openNew()">＋ New Shot</button>

  <div class="list" id="shotList"></div>
</section>

<!-- NEW SHOT -->
<section id="new" class="hidden">
  <div class="top">
    <div class="title" id="formTitle">New Shot</div>
    <button class="btn" onclick="back()">Cancel</button>
  </div>

  <label>Bean</label>
  <input id="bean">

  <label style="margin-top:10px">Bean Type</label>
  <div class="chips" id="beanType"></div>
  <input id="customBlend" class="hidden" placeholder="Describe blend">

  <label style="margin-top:10px">Brew Method</label>
  <select id="brewMethod" onchange="toggleMethod()">
    <option>Espresso</option>
    <option>Pour Over</option>
    <option>Cold Brew</option>
  </select>

  <div id="espressoFields">
    <div class="grid2">
      <input id="grind" placeholder="Grind">
      <input id="dose" placeholder="Dose (g)">
      <input id="yield" placeholder="Yield (g)">
      <input id="time" placeholder="Time (s)">
    </div>
  </div>

  <label style="margin-top:10px">Flavor Profile</label>
  <div id="flavor"></div>

  <button class="btn btnPrimary" style="margin-top:14px;width:100%" onclick="save()">Save</button>
  <button class="btn btnDanger hidden" id="deleteBtn" onclick="del()">Delete</button>
</section>

</div>

<script>
let shots=JSON.parse(localStorage.getItem('shots')||'[]');
let view='service', edit=null;

const beanTypes=['Arabica','Robusta','Liberica','Custom Blend'];
const flavors=['Acidity','Sweetness','Body','Bitterness'];

function today(){
  const d=new Date();
  return d.toISOString().slice(0,10);
}
document.getElementById('today').textContent='Today · '+today();

function render(){
  document.getElementById('service').classList.toggle('hidden',view!=='service');
  document.getElementById('new').classList.toggle('hidden',view!=='new');

  const list=document.getElementById('shotList');
  list.innerHTML='';
  shots.filter(s=>s.date===today()).reverse().forEach(s=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`
      <strong>${s.bean}</strong><br>
      <span style="color:#6b6e76">${s.beanType} · ${s.brewMethod}</span><br>
      grind ${s.grind||''} · ${s.dose||''}g → ${s.yield||''}g · ${s.time||''}s<br>
      <small>${s.date}</small><br>
      <button class="btn" onclick="editShot('${s.id}')">Edit</button>
      <button class="btn btnDanger" onclick="remove('${s.id}')">Delete</button>
    `;
    list.appendChild(c);
  });
}

function openNew(){
  edit=null; view='new';
  document.getElementById('formTitle').textContent='New Shot';
  document.getElementById('deleteBtn').classList.add('hidden');
  render();
}

function save(){
  const s={
    id:edit||Math.random().toString(36),
    date:today(),
    bean:bean.value,
    beanType:currentBeanType,
    brewMethod:brewMethod.value,
    grind:grind.value,
    dose:dose.value,
    yield:yield.value,
    time:time.value
  };
  shots=edit?shots.map(x=>x.id===edit?s:x):shots.concat(s);
  localStorage.setItem('shots',JSON.stringify(shots));
  back();
}

function back(){ view='service'; render(); }

function editShot(id){
  const s=shots.find(x=>x.id===id);
  edit=id; view='new';
  bean.value=s.bean;
  grind.value=s.grind;
  dose.value=s.dose;
  yield.value=s.yield;
  time.value=s.time;
  document.getElementById('deleteBtn').classList.remove('hidden');
  render();
}

function remove(id){
  if(confirm('Delete?')){
    shots=shots.filter(x=>x.id!==id);
    localStorage.setItem('shots',JSON.stringify(shots));
    render();
  }
}

let currentBeanType='Arabica';
const bt=document.getElementById('beanType');
beanTypes.forEach(t=>{
  const b=document.createElement('div');
  b.className='chip'+(t==='Arabica'?' active':'');
  b.textContent=t;
  b.onclick=()=>{
    currentBeanType=t;
    [...bt.children].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    document.getElementById('customBlend').classList.toggle('hidden',t!=='Custom Blend');
  };
  bt.appendChild(b);
});

render();
</script>
</body>
</html>
